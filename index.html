<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Xizmat Tanlash</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="top-bar">
    <h2 id="title">Kalkulyator</h2>
    <div class="controls">
      <select id="languageSelect" onchange="changeLang(this.value)">
        <option value="uz">üá∫üáø</option>
        <option value="ru">üá∑üá∫</option>
        <option value="en">en</option>
      </select>
      <button class="toggle-mode" onclick="toggleMode()">üåô</button>
    </div>
  </div>

  <div class="menu" id="mainMenu">
    <h2 id="menuTitle">Xizmatni tanlang:</h2>
    <button onclick="showSection('calc')" id="calcBtn">üî¢ Kalkulyator</button>
    <button onclick="showSection('convert')" id="convertBtn">üí± Valyuta Konvertori</button>
  </div>

  <div class="calculator" id="calculator" style="display:none;">
    <h2 id="titleCalc">Kalkulyator</h2>
    <input type="number" id="num1" placeholder="1-son" />
    <input type="number" id="num2" placeholder="2-son" />
    <select id="operation">
      <option value="add">‚ûï Qo‚Äòshish</option>
      <option value="subtract">‚ûñ Ayirish</option>
      <option value="multiply">‚úñÔ∏è Ko‚Äòpaytirish</option>
      <option value="divide">‚ûó Bo‚Äòlish</option>
    </select>
    <button onclick="calculate()" id="calculateBtn">Hisobla</button>
    <div id="result" class="result"></div>
    <div id="history" class="history"></div>
    <button onclick="clearHistory()" id="clearHistoryBtn">üßπ Tarixni tozalash</button>
    <button onclick="backToMenu()" id="backBtn">‚¨ÖÔ∏è Ortga</button>
  </div>

  <div class="calculator" id="converter" style="display:none;">
    <h2 id="converterTitle">Valyuta Konvertori</h2>
    <input type="number" id="amount" placeholder="Miqdor" />
    <select id="fromCurrency"></select>
    <select id="toCurrency"></select>
    <button onclick="convertCurrency()" id="convertButton">Konvertatsiya</button>
    <div id="convertedResult" class="result"></div>
    <button onclick="backToMenu()" id="backBtn2">‚¨ÖÔ∏è Ortga</button>
  </div>

  <div class="footer" id="footer">Created by Khamidkhanov Muhammadzohid</div>
  <audio id="clickSound" src="click.mp3" preload="auto"></audio>

  <script>
    let currentLang = 'uz';
    const sound = document.getElementById("clickSound");
    const historyArr = [];
    let exchangeRates = {};

    const texts = {
      uz: {
        service: "Xizmatni tanlang:",
        calculator: "Kalkulyator",
        converter: "Valyuta Konvertori",
        calculate: "Hisobla",
        clearHistory: "üßπ Tarixni tozalash",
        back: "‚¨ÖÔ∏è Ortga",
        result: "Natija",
        history: "Tarix",
        amount: "Miqdor",
        created: "Created by Khamidkhanov Muhammadzohid",
        add: "‚ûï Qo‚Äòshish",
        subtract: "‚ûñ Ayirish",
        multiply: "‚úñÔ∏è Ko‚Äòpaytirish",
        divide: "‚ûó Bo‚Äòlish",
        convert: "Konvertatsiya"
      },
      ru: {
        service: "–í—ã–±–µ—Ä–∏—Ç–µ —É—Å–ª—É–≥—É:",
        calculator: "–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä",
        converter: "–ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä –í–∞–ª—é—Ç",
        calculate: "–í—ã—á–∏—Å–ª–∏—Ç—å",
        clearHistory: "üßπ –û—á–∏—Å—Ç–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é",
        back: "‚¨ÖÔ∏è –ù–∞–∑–∞–¥",
        result: "–†–µ–∑—É–ª—å—Ç–∞—Ç",
        history: "–ò—Å—Ç–æ—Ä–∏—è",
        amount: "–°—É–º–º–∞",
        created: "–°–æ–∑–¥–∞–Ω–æ: –•–∞–º–∏–¥—Ö–∞–Ω–æ–≤ –ú—É—Ö–∞–º–º–∞–¥–∑–æ—Ö–∏–¥",
        add: "‚ûï –°–ª–æ–∂–µ–Ω–∏–µ",
        subtract: "‚ûñ –í—ã—á–∏—Ç–∞–Ω–∏–µ",
        multiply: "‚úñÔ∏è –£–º–Ω–æ–∂–µ–Ω–∏–µ",
        divide: "‚ûó –î–µ–ª–µ–Ω–∏–µ",
        convert: "–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å"
      },
      en: {
        service: "Choose a service:",
        calculator: "Calculator",
        converter: "Currency Converter",
        calculate: "Calculate",
        clearHistory: "üßπ Clear History",
        back: "‚¨ÖÔ∏è Back",
        result: "Result",
        history: "History",
        amount: "Amount",
        created: "Created by Khamidkhanov Muhammadzohid",
        add: "‚ûï Add",
        subtract: "‚ûñ Subtract",
        multiply: "‚úñÔ∏è Multiply",
        divide: "‚ûó Divide",
        convert: "Convert"
      }
    };

    function changeLang(lang) {
      currentLang = lang;
      const t = texts[lang];
      document.getElementById('menuTitle').textContent = t.service;
      document.getElementById('calcBtn').textContent = `üî¢ ${t.calculator}`;
      document.getElementById('convertBtn').textContent = `üí± ${t.converter}`;
      document.getElementById('title').textContent = t.calculator;
      document.getElementById('titleCalc').textContent = t.calculator;
      document.getElementById('converterTitle').textContent = t.converter;
      document.getElementById('calculateBtn').textContent = t.calculate;
      document.getElementById('clearHistoryBtn').textContent = t.clearHistory;
      document.getElementById('backBtn').textContent = t.back;
      document.getElementById('backBtn2').textContent = t.back;
      document.getElementById('convertButton').textContent = t.convert;
      document.getElementById('amount').placeholder = t.amount;
      document.getElementById('footer').textContent = t.created;

      const op = document.getElementById('operation').options;
      op[0].text = t.add;
      op[1].text = t.subtract;
      op[2].text = t.multiply;
      op[3].text = t.divide;
    }

    function toggleMode() {
      document.body.classList.toggle("dark-mode");
    }

    function showSection(type) {
      document.getElementById("mainMenu").style.display = "none";
      document.getElementById("calculator").style.display = type === 'calc' ? "block" : "none";
      document.getElementById("converter").style.display = type === 'convert' ? "block" : "none";
    }

    function backToMenu() {
      document.getElementById("mainMenu").style.display = "block";
      document.getElementById("calculator").style.display = "none";
      document.getElementById("converter").style.display = "none";
    }

    async function calculate() {
      try { await sound.play(); } catch {}
      const num1 = parseFloat(document.getElementById("num1").value);
      const num2 = parseFloat(document.getElementById("num2").value);
      const op = document.getElementById("operation").value;
      let result;
      switch(op) {
        case 'add': result = num1 + num2; break;
        case 'subtract': result = num1 - num2; break;
        case 'multiply': result = num1 * num2; break;
        case 'divide': result = num2 !== 0 ? num1 / num2 : '‚àû'; break;
      }
      const resText = `${texts[currentLang].result}: ${result}`;
      document.getElementById("result").textContent = resText;
      historyArr.unshift(`${num1} ${getSymbol(op)} ${num2} = ${result}`);
      document.getElementById("history").innerHTML = `<strong>${texts[currentLang].history}:</strong><br>` + historyArr.slice(0, 10).join("<br>");
    }

    function getSymbol(op) {
      return { add: '+', subtract: '‚àí', multiply: '√ó', divide: '√∑' }[op];
    }

    function clearHistory() {
      historyArr.length = 0;
      document.getElementById("history").innerHTML = "";
    }

    async function fetchRates() {
      const response = await fetch('https://v6.exchangerate-api.com/v6/b619ef166163799d5ee3d2b9/latest/USD');
      const data = await response.json();
      exchangeRates = data.conversion_rates;
      populateCurrencyDropdowns();
    }

    function populateCurrencyDropdowns() {
      const fromSelect = document.getElementById("fromCurrency");
      const toSelect = document.getElementById("toCurrency");
      fromSelect.innerHTML = toSelect.innerHTML = "";
      for (let code in exchangeRates) {
        fromSelect.innerHTML += `<option value="${code}">${code}</option>`;
        toSelect.innerHTML += `<option value="${code}">${code}</option>`;
      }
      fromSelect.value = 'UZS';
      toSelect.value = 'USD';
    }

    function convertCurrency() {
      const amount = parseFloat(document.getElementById("amount").value);
      const from = document.getElementById("fromCurrency").value;
      const to = document.getElementById("toCurrency").value;
      if (!exchangeRates[from] || !exchangeRates[to]) return;
      const usdAmount = amount / exchangeRates[from];
      const converted = usdAmount * exchangeRates[to];
      document.getElementById("convertedResult").textContent = `${texts[currentLang].result}: ${converted.toFixed(2)} ${to}`;
    }

    window.onload = fetchRates;
  </script>
</body>
</html>